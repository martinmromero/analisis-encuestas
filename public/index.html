<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lisis de Encuestas - An√°lisis de Sentimientos</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <img src="logobarcelo_cmyk_jpg.jpg?v=1" alt="Fundaci√≥n H.A. Barcel√≥" class="header-logo" onerror="console.error('Error cargando logo')">
                <div class="header-text">
                    <h1>üìä An√°lisis de Encuestas</h1>
                    <p>Sube tu archivo Excel y obt√©n un an√°lisis de sentimientos detallado</p>
                </div>
            </div>
        </header>

        <main>
            <!-- Navegaci√≥n entre secciones -->
            <nav class="section-nav">
                <button id="analysisTab" class="nav-tab active">üìä An√°lisis de Encuestas</button>
                <button id="columnConfigTab" class="nav-tab">‚öôÔ∏è Configuraci√≥n de Columnas</button>
                <button id="dictionaryTab" class="nav-tab">üìö Gesti√≥n de Diccionario</button>
                <button id="howCalculatedTab" class="nav-tab">üìê ¬øC√≥mo se calculan los resultados?</button>
                <button id="comparisonTab" class="nav-tab" style="display: none;">‚öñÔ∏è Comparar Motores</button>
            </nav>

            <!-- Secci√≥n de an√°lisis de encuestas -->
            <div id="analysisSection" class="main-section">
                
                <!-- Secci√≥n de carga de archivo - PRIMERO -->
                <section class="upload-section">
                <div class="upload-card">
                    <h2>üìÅ 1. Subir Archivo Excel</h2>
                    <form id="uploadForm" enctype="multipart/form-data">
                        <div class="file-input-wrapper">
                            <input type="file" id="excelFile" name="excelFile" accept=".xlsx,.xls,.csv" required>
                            <label for="excelFile" class="file-label">
                                <span class="file-icon">üìÑ</span>
                                <span class="file-text">Seleccionar archivo Excel</span>
                            </label>
                        </div>
                        
                        <!-- Selector de motor de an√°lisis -->
                        <div class="engine-selector-section">
                            <h3>ü§ñ Seleccionar Motor de An√°lisis</h3>
                            <div class="engine-options">
                                <label class="engine-option">
                                    <input type="radio" name="analysisEngine" value="natural" checked>
                                    <div class="engine-card">
                                        <div class="engine-header">
                                            <span class="engine-icon">üß†</span>
                                            <span class="engine-name">Natural.js Enhanced</span>
                                            <span class="engine-badge recommended">Recomendado</span>
                                        </div>
                                        <div class="engine-description">
                                            Diccionario personalizado de 894 palabras en espa√±ol. Ideal para comentarios espec√≠ficos y an√°lisis preciso.
                                        </div>
                                        <div class="engine-stats">
                                            <span>üìä Efectividad: 8.5/10 para espa√±ol</span>
                                        </div>
                                    </div>
                                </label>
                                
                                <label class="engine-option">
                                    <input type="radio" name="analysisEngine" value="nlpjs">
                                    <div class="engine-card">
                                        <div class="engine-header">
                                            <span class="engine-icon">üöÄ</span>
                                            <span class="engine-name">NLP.js (AXA)</span>
                                            <span class="engine-badge advanced">Avanzado</span>
                                        </div>
                                        <div class="engine-description">
                                            Motor de IA con procesamiento avanzado y soporte nativo multiidioma. Mejor para contexto complejo.
                                        </div>
                                        <div class="engine-stats">
                                            <span>üéØ Efectividad: 10.3/10 para espa√±ol</span>
                                        </div>
                                    </div>
                                </label>
                                
                                <label class="engine-option">
                                    <input type="radio" name="analysisEngine" value="both">
                                    <div class="engine-card dual">
                                        <div class="engine-header">
                                            <span class="engine-icon">‚öñÔ∏è</span>
                                            <span class="engine-name">An√°lisis Dual</span>
                                            <span class="engine-badge premium">Premium</span>
                                        </div>
                                        <div class="engine-description">
                                            Combina ambos motores y genera un consenso inteligente. M√°xima precisi√≥n pero mayor tiempo de procesamiento.
                                        </div>
                                        <div class="engine-stats">
                                            <span>üèÜ Mejor precisi√≥n combinada</span>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Indicador de diccionario activo -->
                        <div id="activeDictionaryIndicator" style="background: #f0f7ff; border: 2px solid #4a90e2; border-radius: 8px; padding: 12px; margin: 15px 0; text-align: center;">
                            <strong>üìö Diccionario Activo:</strong> 
                            <span id="activeDictionaryName" style="color: #4a90e2; font-weight: bold;">Cargando...</span>
                            <span id="activeDictionaryStats" style="color: #666; font-size: 0.9em; margin-left: 10px;"></span>
                        </div>
                        
                        <div class="button-group">
                            <div style="display: flex; align-items: center; gap: 10px; flex: 1;">
                                <select id="quickConfigSelect" style="flex: 1; padding: 12px; border: 2px solid #4a90e2; border-radius: 8px; font-size: 14px; background: white; cursor: pointer;">
                                    <option value="">‚öôÔ∏è Seleccionar configuraci√≥n de columnas...</option>
                                </select>
                            </div>
                            <button type="submit" class="analyze-btn" id="analyzeBtn" disabled style="opacity: 0.5; cursor: not-allowed;">
                                <span class="btn-icon">üîç</span>
                                <span id="analyzeBtnText">Selecciona una configuraci√≥n primero</span>
                            </button>
                            <button type="button" id="advancedReportBtn" class="advanced-report-btn">
                                <span class="btn-icon">üìã</span>
                                Generar Reporte XLSX Completo
                            </button>
                        </div>
                    </form>
                    <div class="file-info">
                        <p>üí° <strong>Formatos soportados:</strong> .xlsx, .xls, .csv (separado por ; o ,)</p>
                        <p>üìù <strong>Requisitos:</strong> El archivo debe contener columnas como: carrera, materia, sede, docente, comentarios</p>
                        <p>üéØ <strong>Reporte Completo:</strong> Incluye filtros autom√°ticos, an√°lisis por carrera/docente y colores por sentiment</p>
                    </div>
                </div>
            </section>

            <!-- Loading spinner -->
            <div id="loading" class="loading hidden">
                <div class="spinner"></div>
                <p>Procesando archivo y analizando sentimientos...</p>
            </div>

            <!-- Panel de Filtros (box separado) -->
            <section id="filtersSection" class="filters-section hidden">
                <div class="filters-panel" style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 30px;">
                    <h3 style="cursor: pointer; display: flex; align-items: center; gap: 10px; user-select: none; margin-top: 0;" onclick="document.getElementById('filtersContent').classList.toggle('hidden'); this.querySelector('.toggle-icon').textContent = document.getElementById('filtersContent').classList.contains('hidden') ? '‚ñ∂' : '‚ñº';">
                        <span class="toggle-icon">‚ñ∂</span>
                        üîç Filtrar Resultados <span style="font-size: 0.85em; color: #666; font-weight: normal;">(para encuestas extensas)</span>
                    </h3>
                    <div id="filtersContent" class="filters-grid hidden">
                        <div class="filter-group">
                            <label for="filterCarrera">Carrera:</label>
                            <select id="filterCarrera" class="filter-select">
                                <option value="">Todas las carreras</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="filterMateria">Materia:</label>
                            <select id="filterMateria" class="filter-select">
                                <option value="">Todas las materias</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="filterModalidad">Modalidad:</label>
                            <select id="filterModalidad" class="filter-select">
                                <option value="">Todas las modalidades</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="filterSede">Sede:</label>
                            <select id="filterSede" class="filter-select">
                                <option value="">Todas las sedes</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="filterDocente">Docente:</label>
                            <select id="filterDocente" class="filter-select">
                                <option value="">Todos los docentes</option>
                            </select>
                        </div>
                        <div class="filter-actions">
                            <button id="applyFilters" class="filter-btn apply">
                                <span>‚úì</span> Aplicar Filtros
                            </button>
                            <button id="clearFilters" class="filter-btn clear">
                                <span>‚úï</span> Limpiar
                            </button>
                        </div>
                    </div>
                    <div class="filter-summary" id="filterSummary" style="display: none;">
                        <span id="filterSummaryText"></span>
                    </div>
                </div>
            </section>

            <!-- Secci√≥n de resultados -->
            <section id="results" class="results-section hidden">
                <div class="results-header">
                    <h2>üìà Resultados del An√°lisis</h2>
                </div>

                <h3>üìä  An√°lisis cualitativo</h3>

                <!-- Estad√≠sticas generales -->
                <div class="stats-grid">
                    <!-- Fila 1: M√©tricas generales -->
                    <div class="stat-card">
                        <div class="stat-icon">üìã</div>
                        <div class="stat-content">
                            <h3 id="totalResponses">0</h3>
                            <p>Total Respuestas</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìä</div>
                        <div class="stat-content">
                            <h3 id="quantitativeResponses">0</h3>
                            <p>Respuestas Cualitativas</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚≠ê</div>
                        <div class="stat-content">
                            <h3 id="averageScore">0</h3>
                            <p>Puntuaci√≥n Promedio (0-10)</p>
                        </div>
                    </div>
                    
                    <!-- Fila 2: Sentimientos -->
                    <div class="stat-card sentiment-positive">
                        <div class="stat-icon">üòä</div>
                        <div class="stat-content">
                            <h3 id="positivePercent">0%</h3>
                            <p>Sentimientos Positivos</p>
                        </div>
                    </div>
                    <div class="stat-card sentiment-neutral">
                        <div class="stat-icon">üòê</div>
                        <div class="stat-content">
                            <h3 id="neutralPercent">0%</h3>
                            <p>Sentimiento Neutral</p>
                        </div>
                    </div>
                    <div class="stat-card sentiment-negative">
                        <div class="stat-icon">üòû</div>
                        <div class="stat-content">
                            <h3 id="negativePercent">0%</h3>
                            <p>Sentimientos Negativos</p>
                        </div>
                    </div>
                </div>

                <!-- M√©tricas Num√©ricas Promedio -->
                <div class="numeric-metrics-container" id="numericMetricsContainer" style="display: none;">
                    <h3>üìä An√°lisis cuantitativo</h3>
                    <div class="metrics-grid" id="metricsGrid">
                        <!-- Se llena din√°micamente con JavaScript -->
                    </div>
                </div>

                <!-- Gr√°ficos -->
                <div class="charts-container hidden" id="chartsContainer">
                    <div class="chart-wrapper">
                        <div class="chart-card">
                            <h3>Distribuci√≥n de Sentimientos</h3>
                            <div class="chart-container">
                                <canvas id="sentimentChart" width="400" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <div class="chart-card">
                            <h3>An√°lisis por Categor√≠as</h3>
                            <div class="chart-container">
                                <canvas id="categoryChart" width="400" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tabla de resultados detallados -->
                <!-- NOTA: Secci√≥n oculta para futuras versiones. Funciones asociadas: displayResultsTable(), filterResults(), paginaci√≥n -->
                <div class="table-container hidden" id="detailedResultsTable">
                    <h3 onclick="const content = this.nextElementSibling; content.classList.toggle('hidden'); const icon = this.querySelector('.collapse-icon'); icon.textContent = content.classList.contains('hidden') ? '‚ñ∂' : '‚ñº';" style="cursor: pointer; user-select: none;"><span class="collapse-icon">‚ñ∂</span> Resultados Detallados</h3>
                    <div class="hidden">
                    <div class="table-filters">
                        <select id="filterSentiment">
                            <option value="">Todos los sentimientos</option>
                            <option value="Muy Positivo">Muy Positivo</option>
                            <option value="Positivo">Positivo</option>
                            <option value="Neutral">Neutral</option>
                            <option value="Negativo">Negativo</option>
                            <option value="Muy Negativo">Muy Negativo</option>
                        </select>
                        <input type="text" id="searchText" placeholder="Buscar en el texto...">
                    </div>
                    <div class="table-wrapper">
                        <table id="resultsTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Texto Principal</th>
                                    <th>Clasificaci√≥n</th>
                                    <th>Puntuaci√≥n</th>
                                    <th>Confianza</th>
                                    <th>Palabras Positivas</th>
                                    <th>Palabras Negativas</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    </div>
                </div>
            </section>
        </div>

            <!-- Secci√≥n de configuraci√≥n de columnas -->
            <div id="columnConfigSection" class="main-section hidden">
                <section class="column-config-section">
                    <div class="config-card">
                        <h2>‚öôÔ∏è Configuraci√≥n de Columnas</h2>
                        <p class="config-description">Define qu√© columnas son de identificaci√≥n, num√©ricas (cuantitativas) o de texto libre (cualitativas)</p>
                        
                        <div class="config-controls" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; align-items: start;">
                            <!-- Mitad izquierda: Selector de configuraci√≥n -->
                            <div class="config-selector" style="display: flex; flex-direction: column; gap: 10px;">
                                <label for="savedConfigsSelect">üìã Configuraciones Guardadas:</label>
                                <select id="savedConfigsSelect" style="width: 100%; padding: 10px; font-size: 1em;">
                                    <option value="">-- Seleccionar configuraci√≥n --</option>
                                </select>
                            </div>
                            
                            <!-- Mitad derecha: Botones -->
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <button id="newConfigBtn" class="btn-success" style="flex: 1; min-width: 160px;">‚ûï Nueva Configuraci√≥n</button>
                                <button id="deleteConfigBtn" class="btn-danger" style="flex: 1; min-width: 140px;">üóëÔ∏è Eliminar</button>
                                <button id="showConfigModalBtn" class="btn-primary" style="flex: 1 1 100%; min-width: 200px;">‚úèÔ∏è Editar Configuraci√≥n</button>
                            </div>
                        </div>
                        
                        <!-- Configuraci√≥n actual con detalle colapsable -->
                        <div id="currentConfigPreview" class="config-preview hidden" style="margin-top: 20px;">
                            <h3 style="cursor: pointer; display: flex; align-items: center; gap: 10px;" onclick="document.getElementById('configDetails').classList.toggle('hidden'); this.querySelector('.toggle-icon').textContent = document.getElementById('configDetails').classList.contains('hidden') ? '‚ñ∂' : '‚ñº';">
                                <span class="toggle-icon">‚ñ∂</span>
                                üìä Configuraci√≥n Actual: <span id="currentConfigName">Default</span>
                            </h3>
                            <div id="configDetails" class="config-columns hidden">
                                <div class="column-type-preview">
                                    <h4>üè∑Ô∏è Identificaci√≥n (<span id="previewIdCount">0</span>)</h4>
                                    <div id="previewIdColumns" class="column-pills"></div>
                                </div>
                                <div class="column-type-preview">
                                    <h4>üìä Num√©ricas (<span id="previewNumCount">0</span>)</h4>
                                    <div id="previewNumColumns" class="column-pills"></div>
                                </div>
                                <div class="column-type-preview">
                                    <h4>üí¨ Cualitativas (<span id="previewTextCount">0</span>)</h4>
                                    <div id="previewTextColumns" class="column-pills"></div>
                                </div>
                                <div class="column-type-preview" id="previewUnassignedSection" style="display: none;">
                                    <h4>‚ùì Sin Asignar (<span id="previewUnassignedCount">0</span>)</h4>
                                    <div id="previewUnassignedColumns" class="column-pills"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Secci√≥n de gesti√≥n de diccionario -->
            <div id="dictionarySection" class="main-section hidden">
                <!-- Panel de visualizaci√≥n del diccionario actual -->
                <section class="dictionary-viewer">
                    <h2>üìñ Diccionario Actual de Sentimientos</h2>
                    <div class="dictionary-stats">
                        <div class="stat-item">
                            <span class="stat-number" id="totalWords">0</span>
                            <span class="stat-label">Palabras Total</span>
                        </div>
                        <div class="stat-item positive">
                            <span class="stat-number" id="positiveWords">0</span>
                            <span class="stat-label">Positivas</span>
                        </div>
                        <div class="stat-item negative">
                            <span class="stat-number" id="negativeWords">0</span>
                            <span class="stat-label">Negativas</span>
                        </div>
                        <div class="stat-item neutral">
                            <span class="stat-number" id="neutralWords">0</span>
                            <span class="stat-label">Neutrales</span>
                        </div>
                    </div>

                    <!-- T√≠tulo con bot√≥n de colapsar (fuera del contenedor colapsable) -->
                    <div class="dictionary-collapse-header">
                        <button id="toggleDictionary" class="collapse-toggle-btn collapsed">
                            <span class="collapse-icon">‚ñº</span>
                            <span class="collapse-title">Tabla de Palabras del Diccionario</span>
                        </button>
                    </div>

                    <!-- Contenedor colapsable del diccionario -->
                    <div id="dictionaryTableContainer" class="dictionary-collapsible collapsed">
                    <!-- Filtros para el diccionario -->
                    <div class="dictionary-filters">
                        <select id="sentimentFilter">
                            <option value="">Todos los sentimientos</option>
                            <option value="positive">Solo Positivas</option>
                            <option value="negative">Solo Negativas</option>
                            <option value="neutral">Solo Neutrales</option>
                        </select>
                        <input type="text" id="wordSearch" placeholder="Buscar palabra o frase...">
                        <button id="refreshDictionary" class="refresh-btn">üîÑ Actualizar</button>
                    </div>

                    <!-- Lista de palabras del diccionario -->
                    <div class="dictionary-list">
                        <table id="dictionaryTable">
                            <thead>
                                <tr>
                                    <th>Palabra/Frase</th>
                                    <th>Puntuaci√≥n</th>
                                    <th>Tipo</th>
                                    <th>Origen</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    </div>
                    <!-- Fin contenedor colapsable -->
                </section>

                <!-- Panel de entrenamiento -->
                <section class="training-panel">
                    <h2>üéØ Entrenar Modelo de Sentimientos</h2>
                    
                    <!-- Pesta√±as para cambiar entre diccionario y palabras ignoradas -->
                    <div class="training-tabs">
                        <button class="tab-button active" data-tab="dictionary">üìñ Diccionario</button>
                        <button class="tab-button" data-tab="ignored">üö´ Palabras Ignoradas</button>
                    </div>

                    <!-- Pesta√±a de Diccionario -->
                    <div id="dictionaryContent" class="tab-content active">
                        <div class="training-form">
                            <div class="form-group">
                                <label for="newWord">Palabra o Frase:</label>
                                <input type="text" id="newWord" placeholder="Ej: excelente, muy bueno, no me gusta...">
                            </div>
                            
                            <div class="form-group">
                                <label for="sentimentScore">Puntuaci√≥n de Sentimiento:</label>
                                <div class="score-input">
                                    <input type="range" id="sentimentScore" min="-5" max="5" value="0" step="0.5">
                                    <div class="score-display">
                                        <span id="scoreValue">0</span>
                                        <span id="scoreLabel">Neutral</span>
                                    </div>
                                </div>
                                <div class="score-guide">
                                    <div class="score-item">-5 a -2: Muy Negativo</div>
                                    <div class="score-item">-2 a 0: Negativo</div>
                                    <div class="score-item">0: Neutral</div>
                                    <div class="score-item">0 a 2: Positivo</div>
                                    <div class="score-item">2 a 5: Muy Positivo</div>
                                </div>
                            </div>

                            <div class="form-buttons">
                                <button id="addWord" class="add-btn">‚ûï Agregar al Diccionario</button>
                                <button id="cancelEdit" type="button" class="test-btn hidden">‚úñÔ∏è Cancelar edici√≥n</button>
                                <button id="testWord" class="test-btn">üß™ Probar An√°lisis</button>
                            </div>
                        </div>

                        <!-- Resultado de prueba -->
                        <div id="testResult" class="test-result hidden">
                            <h3>Resultado de Prueba:</h3>
                            <div class="test-output"></div>
                        </div>
                    </div>

                    <!-- Pesta√±a de Palabras Ignoradas -->
                    <div id="ignoredContent" class="tab-content">
                        <div class="ignored-info">
                            <p><strong>‚ÑπÔ∏è Palabras Ignoradas:</strong> Estas palabras/frases no recibir√°n puntaje en el an√°lisis cualitativo y ser√°n excluidas de las estad√≠sticas.</p>
                        </div>

                        <div class="training-form">
                            <div class="form-group">
                                <label for="newIgnoredPhrase">Palabra o Frase a Ignorar:</label>
                                <input type="text" id="newIgnoredPhrase" placeholder='Ej: sin comentario, n/a, -, ...'>
                            </div>

                            <div class="form-buttons">
                                <button id="addIgnored" class="add-btn">‚ûï Agregar a Ignoradas</button>
                            </div>
                        </div>

                        <!-- Lista de palabras ignoradas -->
                        <div class="ignored-list">
                            <h3>üìã Lista de Palabras Ignoradas (<span id="ignoredCount">0</span>)</h3>
                            <div id="ignoredPhrasesList" class="ignored-phrases-container"></div>
                        </div>
                    </div>
                </section>

                <!-- Panel de importaci√≥n/exportaci√≥n -->
                <section class="import-export-panel">
                    <h2>üíæ Gesti√≥n de Diccionarios</h2>
                    
                    <!-- Selector de diccionario activo -->
                    <div class="dictionary-selector">
                        <label for="activeDictionarySelect">Diccionario Activo:</label>
                        <select id="activeDictionarySelect" class="dictionary-select">
                            <option value="default">Diccionario Base (894 palabras)</option>
                        </select>
                        <button id="deleteDictionary" class="btn-small btn-danger" title="Eliminar diccionario seleccionado">üóëÔ∏è</button>
                    </div>
                    
                    <div class="management-buttons">
                        <button id="exportDictionaryExcel" class="management-btn export">
                            üìä Exportar a Excel
                        </button>
                        <button id="importDictionary" class="management-btn import">
                            üì• Importar Diccionario
                        </button>
                        <button id="resetDictionary" class="management-btn reset">
                            üîÑ Restaurar Original
                        </button>
                    </div>

                    <!-- Input oculto para importar archivos -->
                    <input type="file" id="dictionaryFileInput" accept=".json,.xlsx,.xls,.csv" style="display: none;">
                </section>
            </div>

            <!-- Secci√≥n de comparaci√≥n de motores -->
            <div id="comparisonSection" class="main-section hidden">
                <header class="section-header">
                    <h2>‚öñÔ∏è Comparaci√≥n de Motores de An√°lisis</h2>
                    <p>Prueba diferentes motores de an√°lisis de sentimientos para encontrar el mejor para tu caso de uso</p>
                </header>

                <!-- Panel de motores disponibles -->
                <section class="engines-section">
                    <h3>üîß Motores Disponibles</h3>
                    <div class="engines-grid" id="enginesGrid">
                        <!-- Los motores se cargar√°n din√°micamente -->
                    </div>
                </section>

                <!-- Panel de prueba de texto -->
                <section class="test-section">
                    <h3>üß™ Prueba de An√°lisis</h3>
                    <div class="test-card">
                        <div class="test-input">
                            <label for="testText">Texto a analizar:</label>
                            <textarea id="testText" rows="4" placeholder="Escribe aqu√≠ el texto que quieres analizar con diferentes motores...">El servicio fue excelente, super√≥ mis expectativas completamente. Estoy muy satisfecho con la calidad.</textarea>
                        </div>
                        
                        <div class="engine-selection">
                            <label>Seleccionar motores para comparar:</label>
                            <div class="engine-checkboxes" id="engineCheckboxes">
                                <!-- Se cargar√°n din√°micamente -->
                            </div>
                        </div>
                        
                        <button id="compareEngines" class="compare-btn">
                            <span>‚öñÔ∏è</span> Comparar Motores
                        </button>
                    </div>
                </section>

                <!-- Loading para comparaci√≥n -->
                <div id="comparisonLoading" class="loading hidden">
                    <div class="spinner"></div>
                    <p>Analizando con m√∫ltiples motores...</p>
                </div>

                <!-- Resultados de comparaci√≥n -->
                <section id="comparisonResults" class="comparison-results hidden">
                    <h3>üìä Resultados de Comparaci√≥n</h3>
                    
                    <!-- Resumen de consenso -->
                    <div class="consensus-card" id="consensusCard">
                        <!-- Se llenar√° din√°micamente -->
                    </div>
                    
                    <!-- Grid de resultados por motor -->
                    <div class="results-grid" id="resultsGrid">
                        <!-- Se llenar√° din√°micamente -->
                    </div>
                    
                    <!-- Tabla de m√©tricas detalladas -->
                    <div class="metrics-table-container">
                        <h4>üìã M√©tricas Detalladas</h4>
                        <table class="metrics-table" id="metricsTable">
                            <thead>
                                <tr>
                                    <th>Motor</th>
                                    <th>Puntuaci√≥n</th>
                                    <th>Clasificaci√≥n</th>
                                    <th>Confianza</th>
                                    <th>Tiempo (ms)</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody id="metricsTableBody">
                                <!-- Se llenar√° din√°micamente -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
        </main>

        <footer>
            <p>üí° Esta aplicaci√≥n utiliza an√°lisis de sentimientos para evaluar el contenido de texto en las encuestas</p>
        </footer>
    </div>

    <!-- Modal de Configuraci√≥n de Columnas -->
    <div id="columnConfigModal" class="modal hidden">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>‚öôÔ∏è Configurar Columnas de An√°lisis</h2>
                <button class="modal-close" id="closeConfigModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="config-instructions">
                    <p>üìã <strong>Instrucciones:</strong> Arrastra las columnas a las categor√≠as correspondientes o usa los botones para moverlas.</p>
                    <p>üí° <strong>Tip:</strong> Las columnas de identificaci√≥n y num√©ricas NO se analizan para sentiment.</p>
                </div>
                
                <div class="config-name-section">
                    <label for="configNameInput">üìù Nombre de esta configuraci√≥n:</label>
                    <input type="text" id="configNameInput" placeholder="Ej: Encuesta Docentes 2025" value="Default" style="max-width: 400px;">
                </div>
                
                <div class="columns-config-grid">
                    <div class="column-category" data-type="identificacion">
                        <h3>üè∑Ô∏è Identificaci√≥n</h3>
                        <p class="category-desc">Datos para filtrar y agrupar (no se analizan)</p>
                        <div id="idColumnsList" class="columns-list" data-category="identificacion"></div>
                    </div>
                    
                    <div class="column-category" data-type="numericas">
                        <h3>üìä Num√©ricas (Cuantitativas)</h3>
                        <p class="category-desc">Escalas num√©ricas para estad√≠sticas</p>
                        <div id="numColumnsList" class="columns-list" data-category="numericas"></div>
                    </div>
                    
                    <div class="column-category" data-type="textoLibre">
                        <h3>üí¨ Texto Libre (Cualitativas)</h3>
                        <p class="category-desc">Comentarios para an√°lisis de sentiment</p>
                        <div id="textColumnsList" class="columns-list" data-category="textoLibre"></div>
                    </div>
                    
                    <div class="column-category unassigned" data-type="unassigned">
                        <h3>‚ùì Sin Asignar</h3>
                        <p class="category-desc">Columnas detectadas en el archivo</p>
                        <div id="unassignedColumnsList" class="columns-list" data-category="unassigned"></div>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button id="saveConfigBtn" class="btn-success">üíæ Guardar Configuraci√≥n</button>
                    <button id="applyConfigBtn" class="btn-primary">‚úÖ Aplicar y Continuar</button>
                    <button id="cancelConfigBtn" class="btn-secondary">‚ùå Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Configuraci√≥n de Escala -->
    <div id="scaleConfigModal" class="modal hidden">
        <div class="modal-content small">
            <div class="modal-header">
                <h2>‚öôÔ∏è Configurar Escala Num√©rica</h2>
                <button class="modal-close" id="closeScaleModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="scale-config-form">
                    <p><strong>Columna:</strong> <span id="scaleColumnName"></span></p>
                    
                    <div id="autoDetectedBadge" class="auto-detected-badge hidden">
                        ‚ú® Escala detectada autom√°ticamente
                    </div>
                    
                    <div class="form-group">
                        <label for="scaleMinInput">Valor M√≠nimo:</label>
                        <input type="number" id="scaleMinInput" placeholder="Ej: 1" value="1" min="0" step="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="scaleMaxInput">Valor M√°ximo:</label>
                        <input type="number" id="scaleMaxInput" placeholder="Ej: 5" value="5" min="1" step="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="scaleDirectionSelect">Direcci√≥n de la Escala:</label>
                        <select id="scaleDirectionSelect" class="scale-direction-select">
                            <option value="ascending">‚¨ÜÔ∏è Ascendente (1 = Peor, 5 = Mejor)</option>
                            <option value="descending">‚¨áÔ∏è Descendente (5 = Peor, 1 = Mejor)</option>
                        </select>
                        <p class="direction-hint" id="directionHint">El valor m√≠nimo representa la peor calificaci√≥n</p>
                    </div>
                    
                    <div class="scale-examples">
                        <p><strong>Ejemplos comunes:</strong></p>
                        <ul>
                            <li>Escala 1-5 Ascendente (Likert est√°ndar)</li>
                            <li>Escala 1-10 Ascendente (NPS)</li>
                            <li>Escala 5-1 Descendente (ranking inverso)</li>
                        </ul>
                    </div>
                    
                    <div class="form-group" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e0e0e0;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="applyToAllNumeric" style="width: auto;">
                            <span>‚ú® Usar esta misma configuraci√≥n para todas las preguntas num√©ricas</span>
                        </label>
                        <p style="font-size: 0.9em; color: #666; margin-top: 8px; margin-left: 28px;">Esta opci√≥n aplicar√° la escala y direcci√≥n configuradas a todas las columnas num√©ricas de la encuesta.</p>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button id="saveScaleBtn" class="btn-success">‚úÖ Guardar Escala</button>
                    <button id="cancelScaleBtn" class="btn-secondary">‚ùå Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de explicaci√≥n de c√°lculos -->
    <div id="calculationsModal" class="modal-overlay" style="display: none;">
        <div class="modal-content calculations-modal">
            <div class="modal-header">
                <h2>üìê ¬øC√≥mo se Calculan los Resultados?</h2>
                <button class="modal-close" id="closeCalculationsModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="calculation-section">
                    <h3>üìä An√°lisis Cuantitativo (Preguntas Num√©ricas)</h3>
                    <p><strong>¬øQu√© se analiza?</strong> Preguntas con escala num√©rica (t√≠picamente 1-10)</p>
                    <div class="formula-box">
                        <p><strong>F√≥rmula de Promedio:</strong></p>
                        <code>Promedio = Œ£(valores v√°lidos) / cantidad de valores v√°lidos</code>
                    </div>
                    <p><strong>Ejemplo:</strong></p>
                    <p>Si las respuestas son: [10, 9, 10, 8, null, 10, 9, "", 10]</p>
                    <ul>
                        <li>Valores v√°lidos: [10, 9, 10, 8, 10, 9, 10] = 7 respuestas</li>
                        <li>Suma: 10 + 9 + 10 + 8 + 10 + 9 + 10 = 66</li>
                        <li>Promedio: 66 / 7 = <strong>9.43</strong></li>
                    </ul>
                    <p class="note">‚ö†Ô∏è Las celdas vac√≠as o con texto inv√°lido se excluyen del c√°lculo</p>
                </div>

                <div class="calculation-section">
                    <h3>üé≠ An√°lisis Cualitativo (Comentarios de Texto)</h3>
                    <p><strong>¬øQu√© se analiza?</strong> Comentarios de texto libre usando an√°lisis de sentimientos con diccionario especializado</p>
                    
                    <h4>Paso 1: Normalizaci√≥n del Texto</h4>
                    <p>El texto se convierte a min√∫sculas, se eliminan acentos y se divide en palabras (tokens).</p>
                    <p><strong>Ejemplo:</strong> "La profesora es EXCELENTE!" ‚Üí ["la", "profesora", "es", "excelente"]</p>
                    
                    <h4>Paso 2: B√∫squeda en Diccionario</h4>
                    <p>Cada palabra se busca en el diccionario de sentimientos (569 palabras):</p>
                    <ul>
                        <li>"excelente" ‚Üí +5 puntos (muy positivo)</li>
                        <li>"bueno" ‚Üí +3 puntos (positivo)</li>
                        <li>"malo" ‚Üí -3 puntos (negativo)</li>
                        <li>"p√©simo" ‚Üí -5 puntos (muy negativo)</li>
                    </ul>
                    
                    <h4>Paso 3: Score RAW</h4>
                    <p>Se suman todos los puntos encontrados (puede ser cualquier valor).</p>
                    <div class="formula-box">
                        <code>Score RAW = Œ£(puntos palabras positivas) - Œ£(puntos palabras negativas)</code>
                    </div>
                    
                    <h4>Paso 4: Normalizaci√≥n a Escala 0-10</h4>
                    <p>El score RAW se normaliza a una escala de 0 a 10:</p>
                    <div class="formula-box">
                        <code>Score Normalizado = (min(max(Score RAW, -10), 10) + 10) / 2</code>
                    </div>
                    <ul>
                        <li>Score RAW = -10 ‚Üí 0.0 (Muy Negativo)</li>
                        <li>Score RAW = 0 ‚Üí 5.0 (Neutral)</li>
                        <li>Score RAW = +10 ‚Üí 10.0 (Muy Positivo)</li>
                    </ul>
                    
                    <h4>Paso 5: Clasificaci√≥n</h4>
                    <p>Seg√∫n el score normalizado (0-10):</p>
                    <ul>
                        <li><strong>Muy Positivo:</strong> score ‚â• 8</li>
                        <li><strong>Positivo:</strong> 6 ‚â§ score &lt; 8</li>
                        <li><strong>Neutral:</strong> 4 ‚â§ score &lt; 6</li>
                        <li><strong>Negativo:</strong> 2 ‚â§ score &lt; 4</li>
                        <li><strong>Muy Negativo:</strong> score &lt; 2</li>
                    </ul>
                    
                    <h4>Confianza del An√°lisis</h4>
                    <div class="formula-box">
                        <code>Confianza = (palabras reconocidas / total palabras) √ó 80%</code>
                    </div>
                    <p>Mayor confianza = m√°s palabras del diccionario encontradas en el texto</p>
                </div>

                <div class="calculation-section">
                    <h3>üìà Estad√≠sticas Agregadas</h3>
                    
                    <h4>Porcentajes por Categor√≠a</h4>
                    <div class="formula-box">
                        <code>Porcentaje = (comentarios en categor√≠a / total comentarios analizados) √ó 100</code>
                    </div>
                    <p class="note">‚ö†Ô∏è Los porcentajes se calculan sobre comentarios analizados, NO sobre el total de filas</p>
                    
                    <h4>Puntuaci√≥n Promedio</h4>
                    <p>Promedio de todos los scores normalizados (escala 0-10)</p>
                    <div class="formula-box">
                        <code>Promedio = Œ£(scores normalizados) / cantidad de comentarios</code>
                    </div>
                    
                    <p><strong>Ejemplo:</strong></p>
                    <ul>
                        <li>Total filas en Excel: 1000</li>
                        <li>Filas con comentarios: 150</li>
                        <li>Clasificaciones:</li>
                        <ul>
                            <li>Muy Positivo: 30 ‚Üí 30/150 = 20.0%</li>
                            <li>Positivo: 45 ‚Üí 45/150 = 30.0%</li>
                            <li>Neutral: 40 ‚Üí 40/150 = 26.7%</li>
                            <li>Negativo: 25 ‚Üí 25/150 = 16.7%</li>
                            <li>Muy Negativo: 10 ‚Üí 10/150 = 6.7%</li>
                        </ul>
                    </ul>
                </div>

                <div class="calculation-section">
                    <h3>üîç Filtros</h3>
                    <p>Cuando aplicas filtros (por carrera, materia, docente, etc.), <strong>todas las m√©tricas se recalculan</strong> usando √∫nicamente las filas filtradas.</p>
                    <p>Los filtros se aplican sobre el dataset original, no son acumulativos.</p>
                </div>

                <div class="calculation-section">
                    <h3>üìã Notas Importantes</h3>
                    <ul>
                        <li>‚úì Solo se cuentan filas con datos v√°lidos (no vac√≠as)</li>
                        <li>‚úì Los porcentajes cualitativos se calculan sobre comentarios analizados</li>
                        <li>‚úì La confianza baja indica que el diccionario no reconoce muchas palabras</li>
                        <li>‚úì Escala de sentimientos normalizada: 0 (muy negativo) a 10 (muy positivo)</li>
                        <li>‚úì Escala cuantitativa: configurable seg√∫n la encuesta</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer con n√∫mero de versi√≥n -->
    <footer style="text-align: center; padding: 20px 0; color: #fff; font-size: 0.9em; border-top: 1px solid #e0e0e0; margin-top: 40px;">
        <p>An√°lisis de Encuestas - Fundaci√≥n H.A. Barcel√≥ | Versi√≥n <span id="app-version">cargando...</span></p>
    </footer>

    <script src="cascade-filters.js"></script>
    <script src="app.js"></script>
    <script src="column-config-manager.js"></script>
</body>
</html>